<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.296">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>The most boring yet essential skill: organizing files and codes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="2023-08-31-blog-post-5_files/libs/clipboard/clipboard.min.js"></script>
<script src="2023-08-31-blog-post-5_files/libs/quarto-html/quarto.js"></script>
<script src="2023-08-31-blog-post-5_files/libs/quarto-html/popper.min.js"></script>
<script src="2023-08-31-blog-post-5_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="2023-08-31-blog-post-5_files/libs/quarto-html/anchor.min.js"></script>
<link href="2023-08-31-blog-post-5_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="2023-08-31-blog-post-5_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="2023-08-31-blog-post-5_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="2023-08-31-blog-post-5_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="2023-08-31-blog-post-5_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">The most boring yet essential skill: organizing files and codes</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>The ability to reproduce an analysis is essential for any research project or study based on quantitative data. Reproducibility depends on the data (e.g., availability of raw data), software (e.g., statistical software and/or packages used) as well as hardware and operating system. A basic form of reproducibility is when <strong>you can repeat run your own analysis and obtain the same results you had before</strong>. Being able to understand and track each steps you performed with your data is a key part of this process. The purpose of this blog is to introduce simple tips and tricks that support reproducible science. More advanced practices are introduced at last.</p>
<blockquote class="blockquote">
<p><strong>Disclaimer</strong>: I don’t claim to have perfect coding practices or to have always had state-of-the-art reproducible practice. Rather, I wish to share the experience I acquired until today and allow you to draw inspiration from it according to your needs. Please also note that I focus on reproducibility and coding in the context of academic research and health research in particular. Other fields, e.g., softwares and engineering, may already adopt basic reproducible practices that would be considered advance compared with the concepts I introduce in this blog. Obviously, my modest introduction is not meant for advanced users familiar with coding, versioning, code distribution, etc.</p>
</blockquote>
<section id="prerequisite" class="level1">
<h1>Prerequisite</h1>
<p>To ensure analyses are reproducible, it is essential that you can go from the <strong>raw data file to your results</strong> in a single continuous workflow. In other words, a reproducible analysis allows someone else (or a future you!) to follow the story of your data all the way to your results, including text, tables and figures. Having to intervene “manually”, e.g., typing numbers at some point based on another analysis, or performing back and forth exchange between your data and your analysis would not be considered reproducible. Indeed, the manual operations are not tracked and would have to be repeated each the analysis requires an update.</p>
<p>This means that you <strong>can’t</strong> (and generally should never) modify your raw data in Excel for example, at least once it is finalized. Similarly, you shouldn’t use point-and-click software like SPSS if you don’t intend to save the generated script that allows you to repeat your analysis.</p>
<p>You may still wonder though, “<em>what if my analysis is fairly simple and does not take a long time to do. Why should I document it with script/code?</em>”. Or, perhaps, “<em>I don’t have time to learn coding since I need results fast!</em>”. My answer is that you should definitely learn at least a little coding. Learning to code is an investment that will save you an enormous amount of time in the medium-to-long term.</p>
<section id="advantages-of-using-analysis-scriptcode" class="level2">
<h2 class="anchored" data-anchor-id="advantages-of-using-analysis-scriptcode">Advantages of Using Analysis Script/Code</h2>
<p>Common data manipulation and analysis steps include renaming variables, recoding values, performing arithmetic operations, transposing data, modelling etc. The importance of all these data manipulation steps is greatly <strong>underappreciated</strong> in science (Leek &amp; Peng, 2015). Perhaps this is a personal hot take, but I am convinced that a given statistic or p-value in a scientific paper is almost meaningless if not <strong>all</strong> steps leading to it are properly documented.</p>
<p>All data cleaning, manipulation and analysis steps <strong>can</strong> and <strong>should</strong> be performed using statistical code or script. A script is the storyline of your analysis. It describes the operations to perform on your dataset and analyses in a given language. Common statistical software/languages include R, python, SAS and SPSS. Having a script of your analysis is extremely useful for many reasons.</p>
<ol type="1">
<li>You can share your script with others for reviewing purpose. Without this storyline, it is almost impossible to know exactly what happened to your data and how you got to the results.</li>
<li>You can go back to an older project and understand what happened. Common situations include a colleague or your advisor asking if you <em>“adjusted for variable X?”</em> or perhaps, if you had considered data from a given study participant?</li>
<li>You can re-run an entire project if new or revised data are available in a matter of minutes instead of having to tweak data manually, and update every values in tables and figures. I have had to do this in the past and it can be very stressful and cumbersome. Typically, even when you think that you are done forever with given analysis, it is often the case that a re-run will be needed later on.</li>
<li>You can reuse your previous codes for any new analysis. For example, complex data manipulations that would take hours to do in Excel can be repeated in a matter of seconds if you saved the code. There is of course a balance between the flexibility of code (ensuring that it can be used in the future in a different context) and short-term time efficiency (making it work right now). Nonetheless, having a starting point very often saves a lot of time.</li>
</ol>
</section>
<section id="which-statistical-software-should-i-use" class="level2">
<h2 class="anchored" data-anchor-id="which-statistical-software-should-i-use">Which Statistical Software Should I Use?</h2>
<p>The tips and tricks I describe below are good for any software. Personally, I have been using R and SAS. For demonstration purpose, I will focus on these two softwares in this blog. When deciding on a statistical analysis software, relevant considerations are:</p>
<ul>
<li><strong>Open source:</strong> R (and python for example) have the advantage of being open source, thus accessible by a larger community</li>
<li><strong>Use within your team:</strong> using the same statistical software as the one used in your research team will make collaboration easier. Being able to use code previously developed or ask your questions to close colleague will significantly speed your work.</li>
<li><strong>Use in university courses you must attend:</strong> having working knowledge of a particular software will make the course much easier.</li>
<li><strong>Career goals:</strong> the relevance of your coding skills after you finish your graduate studies may guide your choice. If you aim to work in private or industry setting, R or python may be better investments. If you aim to work at a government institution, knowing SAS may offer you a significant advantage.</li>
</ul>
<p>All in all, if you have never used any statistical software and you aim to do statistical analyses for academic research, R/RStudio is a great place to start. I believe R offers much more robust solutions to enhance reproducibility, particularly for integrating analysis code, text and results (see <em>More Resources and Advanced Practices</em> below).</p>
</section>
</section>
<section id="the-issue-of-reproducibility-and-organization" class="level1">
<h1>The Issue of Reproducibility and Organization</h1>
<p>Say for example that you analyze your study data and make a table with results. A couple of weeks go by and you need to revisit your analysis. However, your analysis folder includes a variety of code or script: <code>final_first_code</code>, <code>final_code2</code>, <code>final_final_code2</code>, <code>full with tables_correct</code> and others. After a thorough investigation, you manage to find the correct “final” script that allowed you to obtain your results in the first place. However, the output seems drastically different: the results from this “new” run are not consistent with your initial results. This begs the question: were the first results even accurate? Or is it that you forgot a key portion of code in the latest run? You search for clues in the files but you can’t remember in what particular order you had ran your code in the first place. The only solution seems to start from scratch again. What was supposed to be a quick check turns out to require the whole week!</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../images/2023-08-31-blog-post-5_files/meme-code.jpg" class="quarto-discovered-preview-image img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<p>Perhaps the situation described above happened to you or a colleague. Unfortunately, basic practices regarding code organization and reproducibility are not often taught in health graduate programs. My hope is that this blog post can help you get started with good enough practices.</p>
</section>
<section id="step-1.-organization-of-project-files" class="level1">
<h1>Step 1. Organization of Project Files</h1>
<p>Ideally, you should create <strong>one folder</strong> on your computer which will include your data, code and results. This will greatly facilitate “communication” between your script (storyline), your data and your results.</p>
<section id="typical-directory-tree" class="level2">
<h2 class="anchored" data-anchor-id="typical-directory-tree">Typical Directory Tree</h2>
<p>The figure below shows an example of generic directory tree for a resarch project. You can always modify folder name or set-up according to your preferences, but I found this structure to work well.</p>
<pre class="mermaid"><code>%%{init: {'theme': 'neutral' } }%%

flowchart LR
P(["MyProject/"])
P--&gt;A
P--&gt;B
P--&gt;C
P--&gt;D
P--&gt;E
A("Data/")
    A1("Raw/")
    A2("Processed/")
    A--&gt;A1
    A--&gt;A2
    AT1{{"Raw study data&lt;br&gt;(&lt;b&gt;Never&lt;/b&gt; edit manually!)"}}
    A1-.-AT1
    AT2{{"Raw study data once&lt;br&gt;processed with code"}}
    A2-.-AT2
B("Script/")
    BT1{{"Functions (R) or macros (SAS)"}}
    B-.-BT1
C("Results/")
    CT1{{"Intermediate data&lt;br&gt;from analyses"}}
    C-.-CT1
D("Manuscript/")
    D1("Article/")
    D2("OSM/")
    D--&gt;D1
    D--&gt;D2
    DT1{{"Manuscript text with&lt;br&gt;code (e.g., RMD/Quarto)"}}
    D1-.-DT1
    DT2{{"Supplemental material with&lt;br&gt;code (e.g., RMD/Quarto)"}}
    D2-.-DT2
E("Temp/")
    ET1{{"Temporary files&lt;br&gt;(if needed)"}}
    E-.-ET1
</code></pre>
</section>
<section id="other-directory-tree-example" class="level2">
<h2 class="anchored" data-anchor-id="other-directory-tree-example">Other Directory Tree Example</h2>
<p><a href="https://doi.org/10.1371/journal.pcbi.1010356">Figueiredo et al.&nbsp;(2022)</a> provides a great tutorial regarding file organization for a scientific project. These authors also provide a <a href="https://github.com/FellowsFreiesWissen/computational_notebooks/blob/master/kits/R-Python/set_kit.R">tool kit</a> that will automatically create all required folder for a project. I encourage you to read their paper to consolidate your knowledge of file organization and analysis script.</p>
</section>
<section id="multiple-files-for-analysis-codescript" class="level2">
<h2 class="anchored" data-anchor-id="multiple-files-for-analysis-codescript">Multiple Files for Analysis Code/Script</h2>
<p>I like to include the scripts for the main analysis at the root of the project folder, e.g., directly in <code>MyProject/</code> using the directory example above. To track the order in which codes must be executed, I use numerical prefix (e.g., 1.0, 2.0, 3.0) and decimals for subcodes (e.g., 1.1, 1.2, …). A common structure I use is as follows:</p>
<ul>
<li><code>1.0-data_preparation</code>: initial cleaning, manipulation and formatting of raw data;</li>
<li><code>2.0-preliminary_analysis</code>: derived variables based on data from the previous code, descriptive statistics or multiple imputation procedures are example of code that can be included here;</li>
<li><code>3.0-main_analysis</code>: the main analysis of your project. Additional subcodes can be used if a given analysis is complex or requires multiple steps (e.g., <code>3.1-main_analysis_A</code>, <code>3.2-main_analysis_B</code>,…);</li>
<li><code>4.0-main_analysis_objective2</code>: when very different statistical analyses are used, separating the code in a new script with a different prefix may enhance clarity;</li>
<li><code>5.0-results</code>: any additional steps needed to obtain or prepare your results. This can include gathering data in a format suitable for table presentation or figure preparation. Typical examples include rounding numbers, aggregating estimate with their confidence intervals or preparing figures. More complex analysis may include dealing with multiple imputation data or performing bootstrap variance estimation.</li>
<li><code>9.0-manuscript</code>: I recommend using RMarkdown/Quarto to create a single document that will include analysis, text, tables and figures (see <em>More Resources and Advanced Practices</em> below).</li>
</ul>
<p>I find this structure is especially useful when dealing with analyses that include very computationally intensive steps. Indeed, I can run each script separately which is essential when one in particular may take hours to complete.</p>
<p>You can obviously adapt this example to your needs. For example, in the case of less complex and less computationally intensive analysis, perhaps <em>all</em> the script/code above could be integrated in a single file: <code>9.0-manuscript</code>. In such case, you would still adopt a structure similar to the one above, but instead of having multiple <strong>scripts</strong>, you would have multiple clearly defined <strong>sections</strong>.</p>
<section id="main-analysis-script-vs.-script-folder" class="level3">
<h3 class="anchored" data-anchor-id="main-analysis-script-vs.-script-folder">Main Analysis Script vs.&nbsp;Script Folder</h3>
<p>The <code>Script/</code> folder within a project is most useful to include custom <strong>functions</strong> (R) or <strong>macros</strong> (SAS) made to perform specific tasks. Such codes are commonly use for repetitive tasks and to make the main analysis file less cumbersome.</p>
<p>For example, you may need to read/import many Excel files and clean values the same way for each, e.g., convert number stored in character field to numerical or remove spaces in variables names. One way to do this is to write the code and copy/paste it for each datafile. A much better way to do this is to write a function that will perform all these steps according to the varying input dataset. Instead of copy/pasting your code for each datafile separately, you can use your custom in-house function, e.g., <code>Script/read_n_format_xlsx.R</code>, and apply it to each datafile. If you ever need to change one of the steps, you would only need to modify the function once instead of every instances where you copy/pasted your code. All in all, any repetitive task you must perform should ideally be coded as a function that can be reused and updated fairly easily.</p>
<blockquote class="blockquote">
<p>A general advice when writing functions or macros is to focus on <strong>small, manageable code</strong> at a time instead of trying to write one big chunk of code that does everything. When there are errors, the latter is harder to debug since more code must be revised to find the source of the errors.</p>
</blockquote>
<section id="functions-in-r" class="level4">
<h4 class="anchored" data-anchor-id="functions-in-r">Functions in R</h4>
<p>You can ask R to keep the script in memory by writing <code>source(./Script/read_n_format_xlsx.R)</code> before executing the code. This assumes the R script file <code>read_n_format_xlsx.R</code> exists in the folder <code>/Script/</code>.</p>
<p>See an example below of a function that could be put in the <code>Script/</code> folder and used multiple times for different files.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R function to read an Excel file, 'clean' variables names, rows and columns</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>read_n_format_xlsx <span class="ot">&lt;-</span> <span class="cf">function</span>(my_file){</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  my_file_ready <span class="ot">&lt;-</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(my_file) <span class="sc">|&gt;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">remove_empty</span>()</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(my_file_ready)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="macros-in-sas" class="level4">
<h4 class="anchored" data-anchor-id="macros-in-sas">Macros in SAS</h4>
<p>You can ask SAS to keep a macro in memory by writing <code>%include "./Macros/read_n_format_xlsx.sas";</code> before executing the code. This assumes a <code>.sas</code> file file named <code>read_n_format_xlsx.sas</code> exists in the folder <code>/Macros/</code>.</p>
</section>
</section>
</section>
</section>
<section id="step-2.-dealing-with-file-location" class="level1">
<h1>Step 2. Dealing with File Location</h1>
<p>A common step to all projects is that we need our code to read the data. Thus, we need a way to tell the statistical software <em>where</em> the data are located on the computer.</p>
<section id="file-location-in-r" class="level2">
<h2 class="anchored" data-anchor-id="file-location-in-r">File Location in R</h2>
<p>In R, the best method to deal with file location is to use a combination of an <em>R project</em> and the <code>here</code> package.</p>
<p>First, create a project using in RStudio by clicking on <code>File</code> then <code>New Project</code>. A window similar to one in the picture below should appear. You can then create a project in a new folder or associate it to an existing folder.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../images/2023-08-31-blog-post-5_files/figure-commonmark/project.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<p>You can then open the project by clicking on the <code>YourProject.Rproj</code> file. Basically, this opens an RStudio window and sets the working directory to the root of your project folder. For example, if you type and execute <code>getwd()</code> after opening your project, the working directory should be your project folder.</p>
<p>Next, you can now refer to any file using <code>here::here()</code>. For example, based on the sample directory tree I presented above, I would write the following code to read a data named <code>final_data_2023-08.csv</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 0) Assuming a project ("Your_Project.Rproj") file was created:</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Create shortcuts to the raw and processed data folder</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  rawdata_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">'Data'</span>, <span class="st">'Raw'</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  procdata_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">'Data'</span>, <span class="st">'Processed'</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Read hypothetical raw (unedited) CSV data</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  raw_data <span class="ot">&lt;-</span> </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read.csv</span>(<span class="fu">file.path</span>(rawdata_dir, </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'final_data_2023-08.csv'</span>))</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) ... data cleaning, manipulation and preparation ...</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) Save hypothetical 'clean' R data</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS</span>(processed_data,</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> <span class="fu">file.path</span>(procdata_dir,</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>                           <span class="st">'final_data_processed.rds'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For comparison purpose, here is the same code written <strong>without</strong> a <code>.Rproj</code> file and <code>here::here()</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) set working directory - To update manually</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">'/Users/Your_Name/Documents/Your_project/'</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Read hypothetical raw (unedited) CSV data - To update manually</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>raw_data <span class="ot">&lt;-</span> </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read.csv</span>(<span class="fu">file.path</span>(<span class="st">'Users'</span>, <span class="st">'Your_Name'</span>, <span class="st">'Documents'</span>, </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>                     <span class="st">'Your_project'</span>, <span class="st">'Data'</span>, <span class="st">'Raw'</span>,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>                     <span class="st">'final_data_2023-08-20.csv'</span>))</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) ... data cleaning, manipulation and preparation ...</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) Save hypothetical 'clean' R data - To update manually</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(processed_data,</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">file =</span> <span class="fu">file.path</span>(<span class="st">'Users'</span>, <span class="st">'Your_Name'</span>, <span class="st">'Documents'</span>,</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>                         <span class="st">'Your_project'</span>, <span class="st">'Data'</span>, <span class="st">'Processed'</span>,</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>                         <span class="st">'final_data_processed.rds'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The combination of <code>.Rproj</code> file and <code>here::here()</code> seems a bit complicated at first. However, using the <code>here</code> package has the advantage of making your project instantly transportable on a different machine without further modifications. Indeed, absolute paths (<code>Users/Your_Name/Documents/Your_project/Data/Raw/</code>) may be modified if you change computer. You also have to update <em>all</em> absolute paths when you send your files to another person, e.g., if you want a colleague to revise your work. In sum, using the combination of an R project and <code>here::here()</code> is much more efficient than to revise each absolute path manually.</p>
</section>
<section id="file-location-in-sas" class="level2">
<h2 class="anchored" data-anchor-id="file-location-in-sas">File Location in SAS</h2>
<p>There is unfortunately no elegant solutions in SAS. The only tolerable method I found so far is to create an initial “path” (or any other name you like) macro variable that will indicate the <em>absolute</em> path to your files. Then, this macro variable can be used to refer to <em>relative</em> file path afterwards.</p>
<p>For example, I would write the following line early in my <code>.sas</code> file: <code>%let path = C:/Users/Your_name/Documents/Your_Project/;</code>. Then, library can be defined relatively using the macro varialbe <code>&amp;path.</code>. For a libname named “rawdata”, you would write : <code>libname rawdata "&amp;path./Data/Raw/";</code>. An example of that workflow is <a href="https://github.com/didierbrassard/nci_workshop/blob/main/01_Basics.sas">shown here</a>.</p>
<p>Now that we have a proper project folder with a robust method to read and write data, I introduce different strategies to organize the analysis code itself.</p>
</section>
</section>
<section id="step-3.-organization-within-an-analysis-codescript" class="level1">
<h1>Step 3. Organization Within an Analysis Code/Script</h1>
<p>A good but often forgotten practice is to use <strong>comments</strong> in your code. Comments are part of a code that is not interpreted by the software. In other words, the software is blind to the comments, allowing you to write notes and information that complement the actual analysis code.</p>
<p>Useful comments are explicit, tell more than what the code is doing and sometimes explain choices you made.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../images/2023-08-31-blog-post-5_files/meme-code2.jpg" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<section id="comments-in-r" class="level2">
<h2 class="anchored" data-anchor-id="comments-in-r">Comments in R</h2>
<p>In R, comments are added using <code>#</code>, e.g., <code># Your comment goes here</code>. R will not interpret anything after the <code>#</code>.</p>
</section>
<section id="examples-of-comment" class="level2">
<h2 class="anchored" data-anchor-id="examples-of-comment">Examples of Comment</h2>
<p><code>mtcars</code> is a built-in data in R that I use to show example of comments around simple statistical procedures.</p>
<section id="not-so-useful-comment" class="level3">
<h3 class="anchored" data-anchor-id="not-so-useful-comment">Not-so-useful comment</h3>
<p>The comment simply repeats what the analysis is doing. It does not add useful information.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate mean</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(mtcars<span class="sc">$</span>hp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="more-useful-comment" class="level3">
<h3 class="anchored" data-anchor-id="more-useful-comment">More useful comment</h3>
<p>More useful comment may inform about the purpose of the calculation.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate mean horse power of cars for table 1</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(mtcars<span class="sc">$</span>hp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Another useful note is to explain why a certain choice was made.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate median horse power of cars for table 1</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">median</span>(mtcars<span class="sc">$</span>hp) <span class="co"># note: using median since data are skewed</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Comments can also be used to mark code section more clearly. This is helpful to visually identify particular sections.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># *********************************************************************** #</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co">#                                                                         #</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">#             Data preparation: cleaning, merging, labeling               #</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">#                                                                         #</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># *********************************************************************** #</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co"># ... analysis code goes here</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co"># ********************************************** #</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co">#             Identify missing data              #</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co"># ********************************************** #</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co"># ... analysis code goes here</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="co"># ********************************************** #</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co">#               Save prepared data               #</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="co"># ********************************************** #</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="co"># ... analysis code goes here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>R will also build sections of code automatically when you enclose your comment using four <code>#</code> or more. This is very useful in long script.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="do">#### Main section 1 ####</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ...</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="do">##### Subsection 1.1 #####</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># ...</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="do">##### Subsection 1.2 #####</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co"># ...</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="do">#### Main section 2 ####</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co"># ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="comments-in-sas" class="level2">
<h2 class="anchored" data-anchor-id="comments-in-sas">Comments in SAS</h2>
<p>Comments can also be used in SAS. There are two common methods to write comments:</p>
<ol type="1">
<li>The combination of asterisk and semicolon, e.g., <code>* your comment goes here;</code></li>
<li>The combination of forward slash with asterisk, e.g., <code>/* your comment goes here */</code></li>
</ol>
<p>In most cases, it doesn’t matter which one you use, but the second option <code>/* your comment goes here */</code> is more robust and will generally work almost anywhere contrary to <code>* your comment goes here;</code>. The important thing is not to forget to enclose your comments with the proper symbol. You must always end your comment with the appropriate symbol (i.e., semicolon or asterisk and forward slash).</p>
<p>You can view an example of <a href="https://didierbrassard.github.io/files/blog2023_1_sas.txt">comment annotations and section marking in SAS here.</a></p>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>A logical folder structure or project directory tree, well-organized and documented analysis scripts, a transportable reference to datafile, and well-organized code with comments and annotations are all important steps towards reproducible research. The time required to integrate those habits will greatly pay-off over time.</p>
<p>I must acknowledge, however, that these habits neither prevent coding errors nor make your actual analysis accurate. Errors are still possible and <em>will</em> happen. However, having a clear storyline around your data in the form of analysis scripts will allow you or your colleagues to identify these errors and their impact.</p>
<blockquote class="blockquote">
<p>As the saying goes, there are coders who <em>make</em> mistake and coders that <em>don’t know</em> they made mistakes.</p>
</blockquote>
</section>
<section id="more-resources-and-advanced-practices" class="level1">
<h1>More Resources and Advanced Practices</h1>
<p>If everything I’ve described above is already part of your skill set, the following section describes a brief introduction to more advanced practices that may be worth investigating. Plus, if you know additional resources that should figure here, please let me know so I can include them!</p>
<section id="tracking-code" class="level2">
<h2 class="anchored" data-anchor-id="tracking-code">Tracking Code</h2>
<p>First, the gold standard approach to reproducibility is to use a code repository like <a href="https://github.com">GitHub</a>. Github allows you to <strong>collaborate</strong> with others and <strong>track</strong> all changes and additions. In my opinion, GitHub is essential for any research project even if you never share anything publicly in the end.</p>
<p>To get started, I found <a href="https://www.youtube.com/watch?v=r50BKIFGCI0&amp;list=PLB5jA40tNf3v1wdyYfxQXgdjPgQvP7Xzg">this video introduction on YouTube really useful</a>.</p>
</section>
<section id="integrating-code-and-results" class="level2">
<h2 class="anchored" data-anchor-id="integrating-code-and-results">Integrating Code and Results</h2>
<p>Second, the ideal scenario is when you can have a single document that includes both your analysis code <strong>and</strong> results (text, tables and figures). I found working with <a href="https://quarto.org/docs/get-started/hello/rstudio.html">Quarto document within RStudio</a> is the best option available for research articles.</p>
<p>Of note, RMarkdown is a similar type of document than Quarto document. Although RMarkdown still available and somewhat similar to Quarto, I suggest you get started with Quarto rather than Rmarkdown. Indeed, Quarto is more recent, thus generally more robust to generate a variety of output (i.e., html, pdf, docx, …) and support multiple languages (<code>R</code>, <code>python</code>).</p>
<p>Even when the primary analysis is done with other software, e.g.&nbsp;<code>SAS</code>, it is possible to use the intermediate data to generate tables, figures and the main text with Quarto. I have made available some examples based on published articles. All analysis codes are hosted on GitHub. The integration of code, text and results greatly reduces the risk of copy/paste errors in the manuscript.</p>
<ol type="1">
<li><p>Adherence to Canada’s Food Guide recommendations on healthy food choices (HEFI-2019) and cardiovascular disease risk in the UK Biobank: <a href="https://github.com/didierbrassard/hefi2019_cvd">SAS codes (main analysis) and Rmarkdown documents (text, figures and supplemental material)</a></p></li>
<li><p>Relationship between HEFI-2019 scores and nutrient intakes among adults 65 years or more from the CCHS 2015 - Nutrition: <a href="https://github.com/didierbrassard/hefi2019_nutrient">SAS codes (main analysis) and Quarto documents (text, figures and supplemental material)</a></p></li>
</ol>
</section>
<section id="software-history" class="level2">
<h2 class="anchored" data-anchor-id="software-history">Software History</h2>
<p>Third, keeping track of all software and packages used, particularly when working with R is necessary for medium or long-term reproducibility.</p>
<section id="r" class="level3">
<h3 class="anchored" data-anchor-id="r">R</h3>
<p>The simplest form of tracking is to add the code <code>sessionInfo()</code> at the end of an R script. The next step is to save the current version of <em>all</em> packages using <code>renv</code> package and <code>renv::init</code> more precisely.</p>
</section>
<section id="sas" class="level3">
<h3 class="anchored" data-anchor-id="sas">SAS</h3>
<p>In SAS, one useful trick is to save the log and output of a given analysis with the <code>FILENAME</code> option. <a href="https://didierbrassard.github.io/files/blog2023_5_sas.txt">This trick is demonstrated here</a>.</p>
</section>
</section>
<section id="automated-pipeline" class="level2">
<h2 class="anchored" data-anchor-id="automated-pipeline">Automated Pipeline</h2>
<p>While you can create sequential script to be executed manually one after the other, e.g., <code>01-code</code>, <code>02-code</code>, <code>03-code</code> and so on, there is an automated version of this available in R with the package <code>targets</code>. <code>targets</code> will automate your analysis flow by tracking which code needs a new run upon modifications, which code is up to date and also automatically generate an analysis pipeline flow chart. I have not yet used <code>targets</code> personally. I think project with a lot of moving pieces or those requiring periodic report generation would greatly benefit from using <code>targets</code>.</p>
</section>
<section id="self-contained-projects" class="level2">
<h2 class="anchored" data-anchor-id="self-contained-projects">Self-Contained projects</h2>
<p><code>Docker</code> is a software that allows the user to generate a single container “file” that will includes everything needed to run a project from scratch. In lay language, <code>docker</code> can freeze files in time, codes and softwares/packages so you can run a given project with an identical set-up later. <a href="https://docs.posit.co/connect/admin/server-management/docker/">Additional information for use with R are available on Posit’s website</a>.</p>
</section>
</section>
<section id="references" class="level1">
<h1>References</h1>
<p>Figueiredo, L., Scherer, C. &amp; Cabral, J. S. (2022) A simple kit to use computational notebooks for more openness, reproducibility, and productivity in research. PLoS Comput Biol, 18(9), e1010356. https://doi.org/10.1371/journal.pcbi.1010356.</p>
<p>Leek, J. T., &amp; Peng, R. D. (2015). Statistics: P values are just the tip of the iceberg. Nature, 520(7549), 612. https://doi.org/10.1038/520612a</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>